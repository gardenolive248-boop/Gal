<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Code Checker â€” Winner or Not</title>
<style>
  :root{
    --bg:#0f1720;
    --card:#0b1220;
    --accent:#6ef0c8;
    --accent-2:#7ea9ff;
    --win:#39d98a;
    --lose:#ff7b7b;
    --muted:#9fb0c8;
  }
  html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;color:#e6f2ff;background:linear-gradient(180deg,#071127 0%, #041022 100%);display:flex;align-items:center;justify-content:center;padding:22px}
  .wrap{width:100%;max-width:920px;display:grid;grid-template-columns:1fr 320px;gap:20px}
  .panel{background:linear-gradient(180deg,var(--card),#061022);border-radius:12px;padding:18px;box-shadow:0 10px 30px rgba(3,6,12,0.6);border:1px solid rgba(255,255,255,0.02)}
  h1{margin:0 0 6px 0;font-size:20px;color:var(--accent)}
  p.lead{margin:0 0 14px 0;color:var(--muted);font-size:13px}
  .form-row{display:flex;gap:8px;align-items:center}
  input[type="text"]{flex:1;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:rgba(255,255,255,0.02);color:inherit;font-size:15px}
  button{padding:10px 12px;border-radius:10px;border:none;background:var(--accent);color:#022;font-weight:700;cursor:pointer}
  .muted{color:var(--muted);font-size:13px}
  .result{margin-top:16px;padding:14px;border-radius:10px;font-weight:700;text-align:center;font-size:16px}
  .result.win{background:linear-gradient(90deg,var(--win),#2fbf7b);color:#032}
  .result.lose{background:linear-gradient(90deg,var(--lose),#e24d4d);color:#220003}
  .controls{display:flex;gap:8px;align-items:center;margin-top:12px}
  .small-btn{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted);padding:8px 10px;border-radius:8px;cursor:pointer}
  .switch{display:flex;gap:8px;align-items:center}
  label{font-size:13px;color:var(--muted)}
  .right{display:flex;flex-direction:column;gap:12px}
  ul.history{list-style:none;margin:0;padding:0;max-height:260px;overflow:auto}
  ul.history li{display:flex;justify-content:space-between;padding:8px;border-radius:8px;margin-bottom:6px;background:rgba(255,255,255,0.02);font-size:13px}
  .badge{padding:4px 8px;border-radius:999px;font-weight:700;font-size:12px}
  .badge.win{background:rgba(57,217,138,0.12);color:var(--win)}
  .badge.lose{background:rgba(255,123,123,0.09);color:var(--lose)}
  .footer{font-size:12px;color:var(--muted);margin-top:8px}
  @media (max-width:880px){
    .wrap{grid-template-columns:1fr;align-items:stretch}
  }
</style>
</head>
<body>
<div class="wrap">
  <div class="panel">
    <h1>Code Checker</h1>
    <p class="lead">Enter a code and the site will tell you whether itâ€™s a winner. Choose a mode: exact whitelist (known winners only) or raffle (deterministic hash-based probability).</p>

    <div class="form-row" style="margin-bottom:8px">
      <input id="codeInput" type="text" placeholder="Enter code (ex: WIN-1234)" aria-label="Code input" />
      <button id="checkBtn">Check</button>
    </div>

    <div class="controls">
      <div class="switch">
        <label for="modeSelect">Mode:</label>
        <select id="modeSelect" aria-label="Mode select" style="margin-left:6px;padding:8px;border-radius:8px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.02);color:inherit">
          <option value="whitelist">Whitelist</option>
          <option value="raffle">Raffle (hash)</option>
        </select>
      </div>

      <div style="margin-left:auto;display:flex;gap:8px">
        <button class="small-btn" id="clearHistory">Clear History</button>
        <button class="small-btn" id="copySample">Copy Sample</button>
      </div>
    </div>

    <div id="resultArea" class="result muted" aria-live="polite">Enter a code and press Check</div>

    <div style="margin-top:12px;display:flex;gap:8px;align-items:center">
      <label for="probRange" class="muted">Raffle chance</label>
      <input id="probRange" type="range" min="1" max="50" step="1" value="8" style="flex:1" />
      <div style="min-width:48px;text-align:right;color:var(--muted)" id="probLabel">8%</div>
    </div>

    <div class="footer">This runs entirely in your browser. The raffle uses the code's SHA-256 hash deterministically so the same code will always give the same result for the same chance setting.</div>
  </div>

  <div class="right">
    <div class="panel">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div style="font-weight:700;color:var(--accent)">Recent checks</div>
        <div class="muted" id="countLabel">0</div>
      </div>
      <ul class="history" id="historyList" aria-live="polite"></ul>
      <div style="margin-top:8px" class="muted small">Sample winning codes in whitelist mode: <strong>WIN-1234</strong>, <strong>LUCKY-2025</strong>, <strong>SECRET-777</strong></div>
    </div>

    <div class="panel">
      <div style="font-weight:700;color:var(--accent);margin-bottom:6px">How it works</div>
      <div class="muted" style="font-size:13px">
        <strong>Whitelist</strong>: exact match against a safe list of known winners (edit the list in code).<br><br>
        <strong>Raffle</strong>: SHA-256(code) is converted to a number and compared to your chosen probability (deterministic â€” same code gives same result).
      </div>
    </div>
  </div>
</div>

<script>
/*
  Code Checker (single-file)
  - Whitelist mode: checks against a pre-defined array of winning codes
  - Raffle mode: deterministic SHA-256 hashing used to compute winner with a chosen chance %
  - History saved in localStorage
*/

// ----- Configuration: change these if you want -----
const WHITELIST = new Set([
  'WIN-1234',
  'LUCKY-2025',
  'SECRET-777',
  'FREEBIE-42'
]);
// localStorage keys
const LS_HISTORY = 'codecheck_history_v1';
const LS_HIGHWIN = 'codecheck_lastwin_v1';

// ----- UI refs -----
const codeInput = document.getElementById('codeInput');
const checkBtn = document.getElementById('checkBtn');
const resultArea = document.getElementById('resultArea');
const modeSelect = document.getElementById('modeSelect');
const probRange = document.getElementById('probRange');
const probLabel = document.getElementById('probLabel');
const historyList = document.getElementById('historyList');
const countLabel = document.getElementById('countLabel');
const clearHistoryBtn = document.getElementById('clearHistory');
const copySampleBtn = document.getElementById('copySample');

probLabel.textContent = probRange.value + '%';
probRange.addEventListener('input', ()=> probLabel.textContent = probRange.value + '%');

// Utility: normalize code (trim + uppercase)
function normalizeCode(s){
  return String(s || '').trim().toUpperCase();
}

// Save to history (most recent first)
function pushHistory(code, mode, result){
  const history = JSON.parse(localStorage.getItem(LS_HISTORY) || '[]');
  history.unshift({code, mode, result, t: Date.now()});
  // keep last 50
  while(history.length > 50) history.pop();
  localStorage.setItem(LS_HISTORY, JSON.stringify(history));
  renderHistory();
}

// Render history
function renderHistory(){
  const history = JSON.parse(localStorage.getItem(LS_HISTORY) || '[]');
  historyList.innerHTML = '';
  for(const item of history){
    const li = document.createElement('li');
    const left = document.createElement('div');
    left.style.maxWidth = '65%';
    left.title = new Date(item.t).toLocaleString();
    left.textContent = item.code;
    const right = document.createElement('div');
    right.style.display = 'flex';
    right.style.gap = '8px';
    const badge = document.createElement('span');
    badge.className = 'badge ' + (item.result === 'win' ? 'win' : 'lose');
    badge.textContent = item.result === 'win' ? 'WIN' : 'NO';
    const meta = document.createElement('span');
    meta.className = 'muted';
    meta.style.fontSize = '12px';
    meta.textContent = item.mode === 'whitelist' ? 'white' : 'raffle';
    right.appendChild(badge);
    right.appendChild(meta);
    li.appendChild(left);
    li.appendChild(right);
    historyList.appendChild(li);
  }
  countLabel.textContent = history.length;
}

// SHA-256 helper using SubtleCrypto -> returns a hex string
async function sha256Hex(text){
  const enc = new TextEncoder();
  const data = enc.encode(text);
  const hash = await crypto.subtle.digest('SHA-256', data);
  // convert to hex
  const arr = Array.from(new Uint8Array(hash));
  return arr.map(b => b.toString(16).padStart(2,'0')).join('');
}

// Convert hex string to a big integer modulo 1_000_000_000 (safe JS integer range)
function hexToNumberMod(hex, mod){
  // take last 12 hex chars (48 bits) to avoid too-large numbers
  const slice = hex.slice(-12);
  return parseInt(slice, 16) % mod;
}

// Decide raffle winner deterministically: compute hash and map to 0..99, compare with chance
async function raffleDecide(code, chancePercent){
  // chancePercent is 1..100
  const h = await sha256Hex(code);
  // map to 0-9999 for fine granularity
  const num = hexToNumberMod(h, 10000);
  // e.g., chancePercent 8% => threshold = 800
  const threshold = Math.round(chancePercent * 100);
  return num < threshold; // deterministic boolean
}

// Update UI result area
function showResult(text, isWin){
  resultArea.textContent = text;
  resultArea.classList.remove('win','lose','muted');
  if(isWin === true){
    resultArea.classList.add('win');
  } else if(isWin === false){
    resultArea.classList.add('lose');
  } else {
    resultArea.classList.add('muted');
  }
}

// Main check flow
async function checkCode(){
  const raw = codeInput.value;
  const code = normalizeCode(raw);
  if(!code){
    showResult('Please enter a code.', null);
    return;
  }

  const mode = modeSelect.value;
  if(mode === 'whitelist'){
    const isWin = WHITELIST.has(code);
    showResult(isWin ? 'ðŸŽ‰ Winner! This code is in the whitelist.' : 'Sorry â€” not a winner (whitelist check).', isWin);
    pushHistory(code, mode, isWin ? 'win' : 'lose');
  } else {
    // raffle
    const chance = Math.max(1, Math.min(50, parseInt(probRange.value || '8', 10)));
    showResult('Checking...', null);
    try{
      const isWin = await raffleDecide(code, chance);
      showResult(isWin ? `ðŸŽ‰ Winner! (Raffle â€” ${chance}% chance)` : `Not a winner (Raffle â€” ${chance}% chance)`, isWin);
      pushHistory(code, mode, isWin ? 'win' : 'lose');
      // store last win for reference
      if(isWin) localStorage.setItem(LS_HIGHWIN, JSON.stringify({code, chance, t:Date.now()}));
    } catch(err){
      console.error(err);
      showResult('Error while checking. Make sure your browser supports crypto.subtle.', null);
    }
  }
}

// Buttons
checkBtn.addEventListener('click', checkCode);
codeInput.addEventListener('keydown', (e)=>{ if(e.key === 'Enter') checkCode(); });

clearHistoryBtn.addEventListener('click', ()=>{
  localStorage.removeItem(LS_HISTORY);
  renderHistory();
  showResult('History cleared.', null);
});

copySampleBtn.addEventListener('click', ()=>{
  // copy a sample code to the input for quick demo
  const sample = Math.random() < 0.4 ? 'WIN-1234' : 'CODE-' + Math.floor(Math.random()*9000+1000);
  codeInput.value = sample;
  codeInput.focus();
});

// initial render
renderHistory();
showResult('Enter a code and press Check', null);

// optional: prefill from clipboard if available (user-friendly)
(async function tryPrefill(){
  try{
    if(navigator.clipboard && !codeInput.value){
      const txt = (await navigator.clipboard.readText()).trim();
      if(txt && txt.length <= 40) codeInput.value = txt;
    }
  }catch(e){}
})();
</script>
</body>
</html>
